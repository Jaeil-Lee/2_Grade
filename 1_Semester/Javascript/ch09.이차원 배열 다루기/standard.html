<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>틱택토</title>
  <style>
    table {
      border-collapse: collapse;
    }
  
    td {
      border: 1px solid black;
      width: 40px;
      height: 40px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- <table>
    <tr>
      <td id="td00"></td>
      <td id="td01"></td>
      <td id="td02"></td>
    </tr>
    <tr>
      <td id="td10"></td>
      <td id="td11"></td>
      <td id="td12"></td>
    </tr>
    <tr>
      <td id="td20"></td>
      <td id="td21"></td>
      <td id="td22"></td>
    </tr>
  </table> -->

  <script>
/*     const $td00 = document.querySelector("#td00"); // 9개

    $td00.addEventListener('click',()=>{}); // 9개
 */
  const {body} = document;  // 구조분해 할당: body상수에는 body태그 엘리먼트객체 할당됨

  const rows = [];

  const $table = document.createElement('table'); // <table></table>
  const $result = document.createElement('div');  // <div></div>

  let turn = 'O';  // 'O' 또는 'X'


  const checkWinner = (target)=>{
    let rowIdx;
    let columnIdx;

/*     rows.forEach((rowsV,rowsI)=>{ //rowsV: rows의 하나의 요소값, rowsI: rows의 인덱스
      rowsV.forEach((colsV,colsI)=>{ //colsV: columns의 하나의 요소값, colsI:  columns의 인덱스
        if (colsV === target){
          rowIdx = rowsI;
          columnIdx = colsI;
        }
      });
    }); */

    rowIdx = target.parentNode.rowIndex;    
    columnIdx = target.cellIndex;

    console.log(target.parentNode);

    console.log(target.parentNode.children);



    let hasWinner = false;
    if(rows[rowIdx][0].textContent===turn &&
       rows[rowIdx][1].textContent===turn &&
       rows[rowIdx][2].textContent===turn){
        hasWinner = true;
    }

    if(rows[0][columnIdx].textContent===turn &&
       rows[1][columnIdx].textContent===turn &&
       rows[2][columnIdx].textContent===turn){
        hasWinner = true;
    }

    if(rows[0][0].textContent===turn &&
       rows[1][1].textContent===turn &&
       rows[2][2].textContent===turn){
        hasWinner = true;
    }

    if(rows[0][2].textContent===turn &&
       rows[1][1].textContent===turn &&
       rows[2][0].textContent===turn){
        hasWinner = true;
    }
    return hasWinner;
  };

  const cEventListenerFunc = (event)=>{  // 콜백함수
    //event.preventDefault();
    if(event.target.textContent !=='') {
      console.log('빈칸아님');
      return;
    }
     
    console.log('빈칸');
    event.target.textContent = turn;    

    const hasWinner = checkWinner(event.target);
    if(hasWinner){
      $result.textContent = `${turn}님이 승리함!!!`;
      $table.removeEventListener('click',cEventListenerFunc);
      return;
    }
    turn = turn==='O'?'X':'O';    

  };

  for(let i=1; i<=3;i++){
    const $tr = document.createElement('tr'); // <tr></tr>
    const columns = [];
    for(let j=1;j<=3;j++){
      const $td = document.createElement('td'); // <td></td>

      columns.push($td);  

      //console.log(columns);

      //$tr.addEventListener('click',cEventListenerFunc);

      $tr.appendChild($td); 
      // j:1 <tr><td></td></tr> j:2 <tr><td></td><td></td></tr> 
      // j:3 <tr><td></td><td></td><td></td></tr> 

    }
    rows.push(columns); 
    //console.log(rows);
    $table.appendChild($tr);
    $table.addEventListener('click',cEventListenerFunc);
  }

  body.appendChild($table);

  



  </script>
  
</body>
</html>